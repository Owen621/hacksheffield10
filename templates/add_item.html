{% extends "base.html" %}
{% block content %}
<h2>Add New Clothing Item (No Image)</h2>

<form id="addForm">
    <input type="text" name="name" placeholder="Clothing name" required>
    <textarea name="description" placeholder="Description"></textarea>
    <button type="submit" id="submitBtn">Mint NFT</button>
</form>

<script>
document.getElementById("addForm").onsubmit = async (e) => {
    e.preventDefault();
    const submitBtn = document.getElementById("submitBtn");
    submitBtn.disabled = true;
    submitBtn.textContent = "Minting NFT...";

    try {
        const walletPublicKey = "{{ wallet_public_key }}";
        if (!walletPublicKey) {
            alert("Please connect your wallet first!");
            submitBtn.disabled = false;
            submitBtn.textContent = "Mint NFT";
            return;
        }

        const name = document.querySelector("input[name='name']").value;
        const description = document.querySelector("textarea[name='description']").value;

        const resp = await fetch("/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, description })
        });

        const result = await resp.json();
        if (!result.success) throw new Error(result.error);

        alert(`NFT minted! Explorer: ${result.explorer_url}`);
        window.location.href = `/item/${result.item_id}`;
    } catch (err) {
        console.error(err);
        alert("Error: " + err.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Mint NFT";
    }
};
</script>
{% endblock %}

